import os
import json

def path_to_dict(path):
    d = {'name': os.path.basename(path)}
    if os.path.isdir(path):
        d['type'] = "directory"
        d['children'] = [path_to_dict(os.path.join(path,x)) for x in os.listdir\
(path)]
    else:
        d['type'] = "file"
    return d

f = open("./src/home.js", "a", encoding="utf-8")
f.truncate(0)
f.write("var dir_tree = ")
json.dump(path_to_dict('./courses/'), f, ensure_ascii=False, indent=4)
f.write("\r\n  var index = null;\r\n  var moduleTitle = null;\r\n  var moduleIndex;\r\n  window.onload = function () {\r\n      var url = document.location.href,\r\n          params = url.split('?')[1].split('&'),\r\n          data = {}, tmp;\r\n      for (var i = 0, l = params.length; i < l; i++) {\r\n          tmp = params[i].split('=');\r\n          data[tmp[0]] = tmp[1];\r\n      }\r\n      console.log(data.name + \" | \" + this.unescape(data.name));\r\n      title = this.unescape(data.name);\r\n      var parser = new DOMParser;\r\n\r\n      ")
f.write("\r\n  var dom = parser.parseFromString(\r\n         \'<!doctype html><body>\' + title ,\'text/html\');")
f.write("\r\n      var decodedString = dom.body.textContent;\r\n      console.log(\"Decode : \" + decodedString);\r\n      title = decodedString;\r\n      this.moduleTitle = title.split(\"#*#\")[0];\r\n      this.index = title.split(\"#*#\")[1];\r\n      document.getElementById('title').innerHTML = this.moduleTitle;\r\n      console.log(\"Index :\" + this.index);\r\n      getMedia();\r\n  }\r\n  function getMedia() {\r\n      var module = dir_tree['children'][index]['children'];\r\n      moduleIndex = dir_tree['children'][index]['children'].findIndex(function (person) {\r\n          return person.name == moduleTitle;\r\n      });\r\n      var mediaTree = module[moduleIndex]['children'];\r\n      var mediaEle = document.getElementById(\"mediaList\");\r\n      var rawMedia = [];\r\n      for (i = 0; i < mediaTree.length; i++) {\r\n          media = mediaTree[i].name;\r\n          if (mediaTree[i].type == \"file\") {\r\n              check = media.slice(-4);\r\n              if (check == \".mp4\") {\r\n                  rawMedia.push(media);\r\n              }\r\n          }\r\n      }\r\n      rawMedia.sort((a, b) => a.split(\".\")[0] - b.split(\".\")[0]);\r\n      for (i = 0; i < rawMedia.length; i++) {\r\n          var node = document.createElement(\"LI\");\r\n          node.className = \"mediali\";\r\n          node.className = \"list-group-item\";\r\n          var textnode = document.createTextNode(rawMedia[i].slice(0, -4));\r\n          node.appendChild(textnode);\r\n          mediaEle.append(node)\r\n      }\r\n  }\r\n  var ul = document.getElementById('mediaList');\r\n  var heaEle = document.getElementById('mediaTitle');\r\n  ul.onclick = function (event) {\r\n      var name = event.target.textContent;\r\n      heaEle.innerHTML = name;\r\n      var mediaPlayer = document.getElementById('mediaPlayer');\r\n      var media_src = \"courses\\\\\\\\\\\/\" + dir_tree['children'][index].name + \"\\\\\\\\\\\/\" + dir_tree['children'][index]['children'][moduleIndex].name + \"\\\\\\\\\\\/\" + name + \".mp4\";\r\n      console.log(media_src);\r\n      mediaPlayer.src = media_src;\r\n  };\r\n  ")

f.close()

f = open("./src/script.js", "a", encoding="utf-8")
f.truncate(0)
f.write("var dir_tree = ")
json.dump(path_to_dict('./courses/'), f, ensure_ascii=False, indent=4)
f.write("\r\n getCourseName(dir_tree);\r\n var index=null;\r\n function getCourseName(main_dir) {\r\n     var total_course = dir_tree['children'].length;\r\n     for (i = 0; i < parseInt(total_course); i++) {\r\n         if (dir_tree['children'][i].type == \"directory\") {\r\n             var node = document.createElement(\"LI\");\r\n             node.className = \"list-group-item\";\r\n             var textnode = document.createTextNode(unescape(dir_tree['children'][i].name) );\r\n             node.appendChild(textnode);\r\n             var main = document.getElementById(\"courseList\");\r\n             main.append(node);\r\n         }\r\n     }\r\n }\r\n var ul = document.getElementById('courseList');\r\n ul.onclick = function (event) {\r\n     var name = event.target.textContent;\r\n     var titleEle = document.getElementById(\"title\");\r\n     titleEle.innerHTML = name;\r\n     var courseContainer = document.getElementById(\"courseContainer\");\r\n     courseContainer.hidden = true;\r\n     var module = document.getElementById(\"module\");\r\n     module.hidden = false;\r\n     var backButton = document.getElementById(\"backButton\");\r\n     backButton.hidden = false;\r\n     console.log(name + \" | \" + unescape(\"&amp\"));\r\n     getModuleList(name);\r\n };\r\n function backButton() {\r\n     var titleEle = document.getElementById(\"title\");\r\n     titleEle.innerHTML = \"My Courses\";\r\n     var courseContainer = document.getElementById(\"courseContainer\");\r\n     courseContainer.hidden = false;\r\n     var module = document.getElementById(\"module\");\r\n     module.hidden = true;\r\n     var backButton = document.getElementById(\"backButton\");\r\n     backButton.hidden = true;\r\n     var moduleList = document.getElementById(\"moduleList\");\r\n     moduleList.innerHTML = '';\r\n     index=null;\r\n }\r\n function getModuleList(courseName) {\r\n     var moduleIndex = dir_tree['children'].findIndex(function (person) {\r\n         return person.name == courseName;\r\n     });\r\n     index = moduleIndex;\r\n     var moduleTree = dir_tree['children'][moduleIndex]['children'];\r\n     var moduleList = document.getElementById(\"moduleList\");\r\n     var rawList = [];\r\n     for (i = 0; i < parseInt(moduleTree.length); i++) {\r\n         var name = moduleTree[i].name;\r\n         if (moduleTree[i].type == \"directory\") {\r\n             rawList.push(name);\r\n         }\r\n     }\r\n     rawList.sort((a, b) => a.split(\".\")[0] - b.split(\".\")[0]);\r\n     for (i = 0; i < rawList.length; i++) {\r\n         var node = document.createElement(\"LI\");\r\n         node.className = \"list-group-item\";\r\n         var textnode = document.createTextNode(rawList[i]);\r\n         node.appendChild(textnode);\r\n         moduleList.append(node);\r\n     }\r\n }\r\n var moduleEle = document.getElementById(\"moduleList\");\r\n moduleEle.onclick = function (event) {\r\n     var name = event.target.innerHTML;\r\n     var currentLocation = window.location.toString().slice(0, -10);\r\n     var url = currentLocation + \"home.html?name=\" + encodeURIComponent(name+\"#*#\"+index);\r\n     window.location.href = url;\r\n };\r\n ")
f.close()

my_dict = path_to_dict('./courses/')

child = my_dict['children']
